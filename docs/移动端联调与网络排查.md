# 移动端联调与「Network Error」排查

> 后端已监听 `0.0.0.0` 并开启 CORS，不限制移动端。若移动端报 **AxiosError: Network Error**，多半是**请求地址或网络环境**问题。

---

## 1. 移动端该用哪个 Base URL？

移动端项目里（如 `src/constants/index.ts` 的 `API_BASE_URL`）需要指向**当前能访问到后端的地址**，随运行方式不同而不同：

| 运行方式 | 谁在访问 | 应填的 Base URL 示例（含 `/api`） |
|----------|----------|-------------------------------------|
| 本机浏览器 / 本机 Postman | 你电脑 | `http://localhost:3000/api` 或 `http://127.0.0.1:3000/api` |
| **Android 模拟器** | 模拟器里的 App | `http://10.0.2.2:3000/api`（10.0.2.2 是模拟器访问宿主机的固定地址） |
| **iOS 模拟器** | 模拟器里的 App | `http://localhost:3000/api` 一般可用 |
| **真机（手机/平板）** | 手机上的 App | `http://你电脑的局域网IP:3000/api`，例如 `http://192.168.43.11:3000/api` |

说明：

- 本项目 `src/constants/index.ts` 里是 **API_BASE_URL**，请求会拼成 `API_BASE_URL + '/hotels'` 等，所以**必须带 `/api`**，不要只填到端口。
- **真机**不能填 `localhost`：在手机里 localhost 是手机自己，不是你的电脑。
- 后端用 Docker 时，端口已映射到主机 3000，所以上面端口都是 **3000**。

---

## 2. 如何查「电脑的局域网 IP」？

- **Windows**：`cmd` 里执行 `ipconfig`，看「以太网」或「WLAN」下的 **IPv4 地址**（如 192.168.x.x）。
- **Mac/Linux**：终端执行 `ifconfig` 或 `ip addr`，看本机局域网地址。

真机与电脑需在**同一 WiFi/局域网**下。手机浏览器访问 `http://你的IP:3000/api/hotels` 能打开后，把 App 里 `src/constants/index.ts` 的 **API_BASE_URL** 改成 `http://你的IP:3000/api`（注意末尾要有 `/api`）。

---

## 3. 后端确认在跑且可访问

在本机先确认接口通：

```bash
# 本机请求（后端在本机或 Docker 时）
curl -s http://localhost:3000/api/hotels | head -c 200
```

若有 JSON 返回说明后端正常。若用真机，在手机浏览器访问：

`http://你的电脑IP:3000/api/hotels`

能打开 → 再把 App 里 **API_BASE_URL** 设为 `http://你的电脑IP:3000/api`。

---

## 4. 常见原因小结

| 现象 | 可能原因 | 处理 |
|------|----------|------|
| 模拟器/真机 Network Error | Base URL 仍是 `localhost` 或 `127.0.0.1` | 按上表改成 `10.0.2.2:3000/api`（Android 模拟器）或 `http://电脑IP:3000/api`（真机） |
| 真机改完 IP 仍不通 | 电脑防火墙拦截 3000 端口 | 在 Windows「允许应用通过防火墙」里放行 Node 或端口 3000 |
| 本机 curl 也不通 | 后端未启动或端口不对 | 先 `docker-compose ps` 或看进程，确认 3000 在监听 |

---

## 5. 后端侧已做的配置（无需再改）

- **监听**：`src/index.js` 里 `app.listen(port, '0.0.0.0')`，对所有网卡监听，局域网可访问。
- **CORS**：`app.js` 里 `app.use(cors())`，不限制来源，移动端可跨域请求。

若移动端 Base URL 正确且同一局域网下仍 Network Error，再检查本机防火墙或公司/校园网是否禁止设备互访。
